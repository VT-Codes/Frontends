const a7_0x149b=['createNoNewMessagesTimeout','addTaskDependencies','number\x20of\x20completed\x20tasks:\x20','../../../utilities/create-no-new-messages-timeout','Found\x20unknown\x20task:\x20','write','message','commandStatus','dependencies','hash','../../../utilities/environment','targetDependencies','parse','log','self','findTask','../../file-storage/file-storage','Starting\x20distributed\x20command\x20execution','../../error/print-run-group-error','reset','Distributed\x20Execution\x20Terminated','start','overrides','indexOf','apply','then','VERBOSE_LOGGING','executionId:\x20','filter','target','../../file-storage/e2e-encryption','defineProperty','note','getRunGroup','addVerticalSeparator','completedTasks','terminalOutput','Extracting\x20artifacts','url','success','projectGraph','map','Processing\x20task\x20','executionStatus','wait','createStartRequest','finally','project','defaultTargetDependencies','size','ENCRYPTION_KEY','./node_modules/.cache/nx','endTask','FileStorage','assign','../../../utilities/waiter','keys','next','projects','strictlyOrderedTargets','addTaskToGraph','error','value','delete','push','Successfully\x20completed\x20running\x20the\x20command.','runUrl','find','tasks','taskId','See\x20run\x20details\x20at\x20','catch','Main\x20job\x20terminated\x20with\x20an\x20error:\x20\x22','strip-json-comments','throw','error:\x20','axiosException','nxCloudDistributedTasksRunner','COMPLETED','cacheDirectory','./distributed-execution.api','logCommand','toString','E2EEncryption','TaskGraphCreator','exit','length','Error:','configuration','submitRunMetrics','Command\x20execution\x20failed.','encryptionKey','printRunGroupError','scheduleTask','criticalErrorMessage','retrieve','has','createTaskGraph','Waiter','addDependencies','Observable'];(function(_0x486e5b,_0x149b25){const _0x579960=function(_0x4a7291){while(--_0x4a7291){_0x486e5b['push'](_0x486e5b['shift']());}};_0x579960(++_0x149b25);}(a7_0x149b,0x194));const a7_0x5799=function(_0x486e5b,_0x149b25){_0x486e5b=_0x486e5b-0x0;let _0x579960=a7_0x149b[_0x486e5b];return _0x579960;};'use strict';var __awaiter=this&&this['__awaiter']||function(_0x2ddc4c,_0x540508,_0x42115e,_0x38a681){function _0x3c8e06(_0x2d66f0){return _0x2d66f0 instanceof _0x42115e?_0x2d66f0:new _0x42115e(function(_0x4c2633){_0x4c2633(_0x2d66f0);});}return new(_0x42115e||(_0x42115e=Promise))(function(_0x195545,_0x52450e){function _0x17b590(_0x431230){try{_0xe28a95(_0x38a681[a7_0x5799('0x39')](_0x431230));}catch(_0x146709){_0x52450e(_0x146709);}}function _0xd85dc(_0x1d1c4c){try{_0xe28a95(_0x38a681[a7_0x5799('0x4a')](_0x1d1c4c));}catch(_0x58787b){_0x52450e(_0x58787b);}}function _0xe28a95(_0x10b930){_0x10b930['done']?_0x195545(_0x10b930[a7_0x5799('0x3e')]):_0x3c8e06(_0x10b930[a7_0x5799('0x3e')])[a7_0x5799('0x19')](_0x17b590,_0xd85dc);}_0xe28a95((_0x38a681=_0x38a681[a7_0x5799('0x18')](_0x2ddc4c,_0x540508||[]))[a7_0x5799('0x39')]());});};Object[a7_0x5799('0x1f')](exports,'__esModule',{'value':!![]});exports['TaskGraphCreator']=exports[a7_0x5799('0x4d')]=void 0x0;const Observable_1=require('rxjs/internal/Observable');const stripJsonComments=require(a7_0x5799('0x49'));const fs_1=require('fs');const distributed_execution_api_1=require(a7_0x5799('0x50'));const file_storage_1=require(a7_0x5799('0x10'));const e2e_encryption_1=require(a7_0x5799('0x1e'));const waiter_1=require(a7_0x5799('0x37'));const environment_1=require(a7_0x5799('0xa'));const print_run_group_error_1=require(a7_0x5799('0x12'));const create_no_new_messages_timeout_1=require(a7_0x5799('0x3'));const metric_logger_1=require('../../../utilities/metric-logger');const {output,getDependencyConfigs,getOutputs,unparse,Cache}=require('../../../utilities/nx-imports');class NoopLifeCycle{[a7_0x5799('0x5d')](_0x107498){}['startTask'](_0x589f7d){}[a7_0x5799('0x34')](_0x4b2649,_0x2f18db){}}function runDistributedExecution(_0x4f0f83,_0x6909b9,_0x1dfc09,_0x2672ac,_0x5c28ec,_0x24455e,_0x4d765a){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x8157a4=JSON[a7_0x5799('0xc')](stripJsonComments((0x0,fs_1['readFileSync'])('nx.json')[a7_0x5799('0x52')]()));const _0x4f0fd0=new TaskOrderer(_0x1dfc09[a7_0x5799('0x28')],getDefaultDependencyConfigs(_0x8157a4,_0x6909b9))['splitTasksIntoStages'](_0x4d765a);const _0x16bc79=yield _0x4f0f83[a7_0x5799('0x15')]((0x0,distributed_execution_api_1[a7_0x5799('0x2d')])(_0x24455e,_0x4f0fd0,_0x6909b9));return yield processTasks(_0x4f0f83,_0x2672ac,_0x5c28ec,_0x6909b9,_0x16bc79,_0x4d765a,_0x1dfc09);});}function processTasks(_0x7f0a06,_0x23c7f1,_0x2c3b31,_0x348cd0,_0x7c3369,_0x581515,_0x59c1ea){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x18aae4={};const _0x5d0fe0=(0x0,create_no_new_messages_timeout_1[a7_0x5799('0x0')])();const _0x558279=new waiter_1[(a7_0x5799('0x62'))]();while(!![]){if(environment_1['VERBOSE_LOGGING']){output['note']({'title':'Waiting...'});}yield _0x558279[a7_0x5799('0x2c')]();const _0x337cae=yield _0x7f0a06['status'](_0x7c3369);if(environment_1['VERBOSE_LOGGING']){output['note']({'title':'Status\x20update','bodyLines':[a7_0x5799('0x1b')+_0x7c3369,'executionStatus:\x20'+_0x337cae['executionStatus'],a7_0x5799('0x2')+_0x337cae[a7_0x5799('0x23')][a7_0x5799('0x56')],a7_0x5799('0x4b')+_0x337cae[a7_0x5799('0x5e')]]});}if(_0x337cae[a7_0x5799('0x5e')]){output[a7_0x5799('0x3d')]({'title':a7_0x5799('0x14'),'bodyLines':[a7_0x5799('0x57'),_0x337cae[a7_0x5799('0x5e')]]});process[a7_0x5799('0x55')](0x1);}_0x5d0fe0(_0x337cae[a7_0x5799('0x23')][a7_0x5799('0x56')]);for(const _0x2269f0 of _0x337cae[a7_0x5799('0x23')]){if(_0x18aae4[_0x2269f0[a7_0x5799('0x45')]])continue;yield processTask(_0x23c7f1,_0x2c3b31,_0x59c1ea,_0x348cd0,_0x581515,_0x2269f0);_0x558279[a7_0x5799('0x13')]();_0x18aae4[_0x2269f0[a7_0x5799('0x45')]]=!![];}if(_0x337cae[a7_0x5799('0x2b')]===a7_0x5799('0x4e')){return{'commandStatus':_0x337cae['commandStatus'],'runUrl':_0x337cae[a7_0x5799('0x42')]};}}});}function processTask(_0x23a54e,_0x21998d,_0x1aac24,_0x15bb23,_0x177a60,_0xb30137){return __awaiter(this,void 0x0,void 0x0,function*(){if(environment_1[a7_0x5799('0x1a')]){output[a7_0x5799('0x20')]({'title':a7_0x5799('0x2a')+_0xb30137[a7_0x5799('0x45')]});}const _0x203134=_0x177a60[a7_0x5799('0x43')](_0x42a192=>_0xb30137[a7_0x5799('0x45')]===_0x42a192['id']);if(!_0x203134){throw new Error(a7_0x5799('0x4')+_0xb30137[a7_0x5799('0x45')]);}if(environment_1[a7_0x5799('0x1a')]){output[a7_0x5799('0x20')]({'title':'Retrieving\x20artifacts\x20from\x20'+_0xb30137[a7_0x5799('0x26')]});}yield _0x23a54e[a7_0x5799('0x5f')](_0xb30137[a7_0x5799('0x9')],_0xb30137[a7_0x5799('0x26')],_0x15bb23[a7_0x5799('0x4f')]||a7_0x5799('0x33'));const _0x31faaa=yield _0x21998d['get'](Object[a7_0x5799('0x36')](Object[a7_0x5799('0x36')]({},_0x203134),{'hash':_0xb30137[a7_0x5799('0x9')]}));const _0x768f8=getOutputs(_0x1aac24[a7_0x5799('0x28')]['nodes'],_0x203134);if(environment_1['VERBOSE_LOGGING']){output[a7_0x5799('0x20')]({'title':a7_0x5799('0x25'),'bodyLines':_0x768f8});}yield _0x21998d['copyFilesFromCache'](_0xb30137[a7_0x5799('0x9')],_0x31faaa,_0x768f8);output[a7_0x5799('0x51')](getCommand(_0x203134));process['stdout'][a7_0x5799('0x5')](_0x31faaa[a7_0x5799('0x24')]);output[a7_0x5799('0x22')]();});}function getCommand(_0xd82c){const _0x5e07c6=unparse(_0xd82c[a7_0x5799('0x16')]||{});const _0x3593ac=_0xd82c['target'][a7_0x5799('0x58')]?':'+_0xd82c['target'][a7_0x5799('0x58')]:'';return['nx','run',_0xd82c[a7_0x5799('0x1d')]['project']+':'+_0xd82c['target'][a7_0x5799('0x1d')]+_0x3593ac,..._0x5e07c6]['join']('\x20');}const nxCloudDistributedTasksRunner=(_0x38b50f,_0x4a0514,_0x4eabfd)=>{if(environment_1[a7_0x5799('0x1a')]){output[a7_0x5799('0x20')]({'title':a7_0x5799('0x11')});}_0x4a0514['lifeCycle']=new NoopLifeCycle();const _0x3cd04a=(0x0,environment_1[a7_0x5799('0x21')])();if(!_0x3cd04a){(0x0,print_run_group_error_1[a7_0x5799('0x5c')])();return process[a7_0x5799('0x55')](0x1);}const _0x118fde=new e2e_encryption_1[(a7_0x5799('0x53'))](environment_1[a7_0x5799('0x32')]||_0x4a0514[a7_0x5799('0x5b')]);const _0x2e5a3c=new file_storage_1[(a7_0x5799('0x35'))](_0x118fde);const _0xae499b=new Cache(_0x4a0514);const _0x5a1bd6=new distributed_execution_api_1['DistributedExecutionApi'](_0x4a0514);runDistributedExecution(_0x5a1bd6,_0x4a0514,_0x4eabfd,_0x2e5a3c,_0xae499b,_0x3cd04a,_0x38b50f)[a7_0x5799('0x19')](_0x502213=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){if(_0x502213[a7_0x5799('0x7')]===0x0){output[a7_0x5799('0x27')]({'title':a7_0x5799('0x41'),'bodyLines':[a7_0x5799('0x46')+_0x502213[a7_0x5799('0x42')]]});}else{output[a7_0x5799('0x3d')]({'title':a7_0x5799('0x5a'),'bodyLines':[a7_0x5799('0x46')+_0x502213[a7_0x5799('0x42')]]});}yield(0x0,metric_logger_1[a7_0x5799('0x59')])(_0x4a0514);process[a7_0x5799('0x55')](_0x502213[a7_0x5799('0x7')]);}))[a7_0x5799('0x47')](_0x4ae1f0=>{output[a7_0x5799('0x3d')]({'title':'Unable\x20to\x20complete\x20a\x20run.','bodyLines':[_0x4ae1f0[a7_0x5799('0x6')]]});if(_0x4ae1f0[a7_0x5799('0x4c')]){console[a7_0x5799('0xd')](_0x4ae1f0[a7_0x5799('0x4c')]);}else{console[a7_0x5799('0xd')](_0x4ae1f0);}_0x5a1bd6['completeRunGroupWithError'](_0x3cd04a,a7_0x5799('0x48')+_0x4ae1f0[a7_0x5799('0x6')]+'\x22')[a7_0x5799('0x2e')](()=>process[a7_0x5799('0x55')](0x1));});return new Observable_1[(a7_0x5799('0x64'))](()=>{});};exports['nxCloudDistributedTasksRunner']=nxCloudDistributedTasksRunner;class TaskOrderer{constructor(_0x2fad15,_0x4a8e3f){this[a7_0x5799('0x28')]=_0x2fad15;this[a7_0x5799('0x30')]=_0x4a8e3f;}['splitTasksIntoStages'](_0x9b05b8){if(_0x9b05b8[a7_0x5799('0x56')]===0x0)return[];const _0x2f606d=[];const _0x211b13=this[a7_0x5799('0x61')](_0x9b05b8);const _0xebdf7f=new Set(_0x9b05b8[a7_0x5799('0x29')](_0x5bc814=>_0x5bc814['id']));let _0xbff6d6=0x0;while(_0xebdf7f[a7_0x5799('0x31')]>0x0){const _0x2271dc=_0x2f606d[_0xbff6d6]=[];for(const _0x113ddd of _0xebdf7f){let _0x2886ba=!![];for(const _0x53df5d of _0x211b13[a7_0x5799('0x8')][_0x113ddd]){if(_0xebdf7f[a7_0x5799('0x60')](_0x53df5d)){_0x2886ba=![];break;}}if(!_0x2886ba){continue;}const _0xe9b547=_0x211b13['tasks'][_0x113ddd];_0x2271dc['push'](_0xe9b547);}for(const _0x2336bc of _0x2271dc){_0xebdf7f[a7_0x5799('0x3f')](_0x2336bc['id']);}_0xbff6d6++;}return _0x2f606d;}[a7_0x5799('0x61')](_0x4bf1e9){const _0x34df65=new TaskGraphCreator(this[a7_0x5799('0x28')],this[a7_0x5799('0x30')]);return _0x34df65[a7_0x5799('0x61')](_0x4bf1e9);}}class TaskGraphCreator{constructor(_0x5cd417,_0x176e62){this[a7_0x5799('0x28')]=_0x5cd417;this[a7_0x5799('0x30')]=_0x176e62;}['createTaskGraph'](_0x2da067){const _0x474765={'roots':[],'tasks':{},'dependencies':{}};for(const _0x44de75 of _0x2da067){this[a7_0x5799('0x3c')](_0x44de75,_0x474765);const _0x5783c0=getDependencyConfigs(_0x44de75[a7_0x5799('0x1d')],this[a7_0x5799('0x30')],this['projectGraph']);if(!_0x5783c0){continue;}this[a7_0x5799('0x1')](_0x44de75,_0x5783c0,_0x2da067,_0x474765);}_0x474765['roots']=Object[a7_0x5799('0x38')](_0x474765[a7_0x5799('0x8')])[a7_0x5799('0x1c')](_0x57af93=>_0x474765[a7_0x5799('0x8')][_0x57af93]['length']===0x0);return _0x474765;}[a7_0x5799('0x1')](_0x22b12d,_0x30f236,_0x39b413,_0x155d7d){for(const _0x148360 of _0x30f236){if(_0x148360[a7_0x5799('0x3a')]===a7_0x5799('0xe')){for(const _0x1aeddf of _0x39b413){if(_0x1aeddf[a7_0x5799('0x1d')][a7_0x5799('0x2f')]===_0x22b12d[a7_0x5799('0x1d')][a7_0x5799('0x2f')]&&_0x1aeddf[a7_0x5799('0x1d')][a7_0x5799('0x1d')]===_0x148360[a7_0x5799('0x1d')]){_0x155d7d[a7_0x5799('0x8')][_0x22b12d['id']]['push'](_0x1aeddf['id']);}}}else if(_0x148360[a7_0x5799('0x3a')]===a7_0x5799('0x8')){const _0x16f529=new Set();this['addDependencies'](_0x22b12d[a7_0x5799('0x1d')][a7_0x5799('0x2f')],_0x148360[a7_0x5799('0x1d')],_0x39b413,_0x155d7d,_0x22b12d['id'],_0x16f529);}}}[a7_0x5799('0x63')](_0x436281,_0x1d47d7,_0x578d97,_0x2e15b9,_0x49d49c,_0x4c6147){_0x4c6147['add'](_0x436281);const _0x3a6916=this['projectGraph'][a7_0x5799('0x8')][_0x436281];if(_0x3a6916){const _0x1c7bd5=_0x3a6916[a7_0x5799('0x29')](_0x4eca08=>_0x4eca08[a7_0x5799('0x1d')]);for(const _0x27c40b of _0x1c7bd5){if(_0x4c6147[a7_0x5799('0x60')](_0x27c40b)){continue;}const _0x2e939b=this[a7_0x5799('0xf')]({'project':_0x27c40b,'target':_0x1d47d7},_0x578d97);if(_0x2e939b){if(_0x2e15b9[a7_0x5799('0x8')][_0x49d49c][a7_0x5799('0x17')](_0x2e939b['id'])===-0x1){_0x2e15b9[a7_0x5799('0x8')][_0x49d49c][a7_0x5799('0x40')](_0x2e939b['id']);}}else{this['addDependencies'](_0x27c40b,_0x1d47d7,_0x578d97,_0x2e15b9,_0x49d49c,_0x4c6147);}}}}[a7_0x5799('0xf')]({project,target},_0x22266a){return _0x22266a['find'](_0x20735a=>_0x20735a[a7_0x5799('0x1d')][a7_0x5799('0x2f')]===project&&_0x20735a['target'][a7_0x5799('0x1d')]===target);}[a7_0x5799('0x3c')](_0x55701a,_0x157631){_0x157631[a7_0x5799('0x44')][_0x55701a['id']]=_0x55701a;_0x157631[a7_0x5799('0x8')][_0x55701a['id']]=[];}}exports[a7_0x5799('0x54')]=TaskGraphCreator;function getDefaultDependencyConfigs(_0x451f8c,_0x3548e1){var _0x47d11d,_0x1871ce;const _0x464f24=(_0x47d11d=_0x451f8c[a7_0x5799('0xb')])!==null&&_0x47d11d!==void 0x0?_0x47d11d:{};const _0x1666d1=_0x3548e1?(_0x1871ce=_0x3548e1[a7_0x5799('0x3b')])!==null&&_0x1871ce!==void 0x0?_0x1871ce:['build']:[];for(const _0x1e3009 of _0x1666d1){_0x464f24[_0x1e3009]=_0x464f24[_0x1e3009]||[];_0x464f24[_0x1e3009][a7_0x5799('0x40')]({'target':_0x1e3009,'projects':a7_0x5799('0x8')});}return _0x464f24;}