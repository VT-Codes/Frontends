const a1_0xb37f=['filter','../../terminal-output/output-obfuscator','error','obfuscate','taskId','MessageReporter','subscribe','value','getMachineInfo','writeFileSync','Subject','hash','endRun','EndOfRunMessage','cloudEnabledTasksRunner','exit','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','../../../utilities/nx-imports','AGENT_RUNNING_IN_DISTRIBUTED_EXECUTION','__awaiter','../../file-storage/e2e-encryption','../../file-storage/file-storage','throw','apply','./cloud-remote-cache','CloudEnabledLifeCycle','FileStorage','submitRunMetrics','waitForStoreRequestsToComplete','parseCommand','cacheDirectory','maskedProperties','next','rxjs/internal/Subject','skipNxCache','map','VERBOSE_LOGGING','CloudRemoteCache','../../../utilities/environment','env','NX_CLOUD_DISTRIBUTED_EXECUTION_ID','anyErrors','getBranch','getRunGroup','done','toISOString','../../../utilities/metric-logger','Executed\x20tasks\x20with\x20hashes:\x20','tasks-hashes-','printCacheHitsMessage','lifeCycle','requests','assign','cacheableOperations','forEach','scan','Agent\x20wasn\x27t\x20able\x20to\x20record\x20its\x20run','stringify','printMessages','./cloud-enabled-life-cycle','ENCRYPTION_KEY','join','all','startRun','note','then','encryptionKey'];(function(_0xa7bb9f,_0xb37f66){const _0x1116c0=function(_0x778e64){while(--_0x778e64){_0xa7bb9f['push'](_0xa7bb9f['shift']());}};_0x1116c0(++_0xb37f66);}(a1_0xb37f,0x90));const a1_0x1116=function(_0xa7bb9f,_0xb37f66){_0xa7bb9f=_0xa7bb9f-0x0;let _0x1116c0=a1_0xb37f[_0xa7bb9f];return _0x1116c0;};'use strict';var __awaiter=this&&this[a1_0x1116('0x9')]||function(_0x516851,_0x1ac082,_0x312993,_0xe40ce3){function _0x51077b(_0x35fbcd){return _0x35fbcd instanceof _0x312993?_0x35fbcd:new _0x312993(function(_0x39bcb2){_0x39bcb2(_0x35fbcd);});}return new(_0x312993||(_0x312993=Promise))(function(_0x30cd27,_0x4db377){function _0x1e2ff0(_0x23d036){try{_0x144973(_0xe40ce3[a1_0x1116('0x16')](_0x23d036));}catch(_0x4878cb){_0x4db377(_0x4878cb);}}function _0x5367ac(_0x563b86){try{_0x144973(_0xe40ce3[a1_0x1116('0xc')](_0x563b86));}catch(_0x1f49c3){_0x4db377(_0x1f49c3);}}function _0x144973(_0x4f8031){_0x4f8031[a1_0x1116('0x22')]?_0x30cd27(_0x4f8031['value']):_0x51077b(_0x4f8031[a1_0x1116('0x40')])[a1_0x1116('0x37')](_0x1e2ff0,_0x5367ac);}_0x144973((_0xe40ce3=_0xe40ce3[a1_0x1116('0xd')](_0x516851,_0x1ac082||[]))[a1_0x1116('0x16')]());});};Object['defineProperty'](exports,'__esModule',{'value':!![]});exports[a1_0x1116('0x4')]=void 0x0;const Subject_1=require(a1_0x1116('0x17'));const message_reporter_1=require('../../terminal-output/message-reporter');const end_of_run_message_1=require('../../terminal-output/end-of-run-message');const output_obfuscator_1=require(a1_0x1116('0x3a'));const cloud_enabled_life_cycle_1=require(a1_0x1116('0x31'));const file_storage_1=require(a1_0x1116('0xb'));const e2e_encryption_1=require(a1_0x1116('0xa'));const environment_1=require(a1_0x1116('0x1c'));const cloud_remote_cache_1=require(a1_0x1116('0xe'));const cloud_run_api_1=require('./cloud-run.api');const fs_1=require('fs');const path=require('path');const metric_logger_1=require(a1_0x1116('0x24'));const {tasksRunnerV2,output}=require(a1_0x1116('0x7'));function createApi(_0xd413c3,_0x114ba4,_0xd10df){const _0x5df9f6=(0x0,environment_1[a1_0x1116('0x41')])(_0x114ba4);return new cloud_run_api_1['CloudRunApi'](_0xd413c3,_0xd10df,_0x114ba4,_0x5df9f6);}function storeTaskHashes(_0xd92134,_0x1b436b,_0x1c205e){const _0xb96160=JSON[a1_0x1116('0x2f')](_0xd92134[a1_0x1116('0x19')](_0x460f41=>({'taskId':_0x460f41[a1_0x1116('0x3d')],'hash':_0x460f41[a1_0x1116('0x1')]})));if(environment_1[a1_0x1116('0x1a')]){output[a1_0x1116('0x36')]({'title':a1_0x1116('0x25')+_0xb96160});}(0x0,fs_1[a1_0x1116('0x42')])(path[a1_0x1116('0x33')](_0x1b436b,a1_0x1116('0x26')+_0x1c205e),_0xb96160);}function onComplete(_0xaf6010,_0x5d20db,_0x1a9f17,_0x112fb5,_0x3b8c7e,_0x375302,_0x45316f,_0x930c6d,_0x2578ee,_0x33f144){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x5baf7c=new Date()[a1_0x1116('0x23')]();if(environment_1[a1_0x1116('0x8')]){storeTaskHashes(_0x2578ee,_0x5d20db[a1_0x1116('0x14')]||'./node_modules/.cache/nx',environment_1[a1_0x1116('0x1e')]);}const _0x473920=(0x0,environment_1[a1_0x1116('0x20')])();const _0x48196d=yield Promise[a1_0x1116('0x34')]([_0x1a9f17[a1_0x1116('0x12')](),_0x112fb5[a1_0x1116('0x2')]({'command':_0x3b8c7e[a1_0x1116('0x3c')]((0x0,environment_1[a1_0x1116('0x13')])()),'startTime':_0x375302,'endTime':_0x5baf7c,'distributedExecutionId':environment_1[a1_0x1116('0x1e')],'branch':_0x473920,'scan':!![],'runGroup':(0x0,environment_1[a1_0x1116('0x21')])(),'sha':_0x473920?(0x0,environment_1['extractGitSha'])():undefined},_0x2578ee)]);if(_0x33f144){setTimeout(()=>{_0x45316f[a1_0x1116('0x30')]();if(!_0x45316f[a1_0x1116('0x1f')]){_0x930c6d[a1_0x1116('0x27')]();}},0x0);}else{_0x45316f[a1_0x1116('0x30')]();if(!_0x45316f[a1_0x1116('0x1f')]){_0x930c6d[a1_0x1116('0x27')]();}}if(environment_1[a1_0x1116('0x8')]){if(!_0x48196d[0x0]){output[a1_0x1116('0x3b')]({'title':'Agent\x20wasn\x27t\x20able\x20to\x20store\x20artifacts'});_0x45316f['printMessages']();process[a1_0x1116('0x5')](environment_1['DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE']);}if(!_0x48196d[0x1]){output['error']({'title':a1_0x1116('0x2e')});_0x45316f['printMessages']();process[a1_0x1116('0x5')](environment_1[a1_0x1116('0x6')]);}}yield(0x0,metric_logger_1[a1_0x1116('0x11')])(_0x5d20db);});}function createLifeCycle(_0x25acad,_0x1676d4,_0x26e331,_0xfbf98b){const _0x36e7c9=new cloud_enabled_life_cycle_1[(a1_0x1116('0xf'))](_0x25acad,_0x1676d4[a1_0x1116('0x14')],!!_0x1676d4[a1_0x1116('0x18')],_0x1676d4['scan']===undefined?!![]:_0x1676d4[a1_0x1116('0x2d')],_0x1676d4[a1_0x1116('0x2b')]||[],_0x26e331,_0xfbf98b);try{const {CompositeLifeCycle}=require(a1_0x1116('0x7'));if(!CompositeLifeCycle)return _0x36e7c9;return new CompositeLifeCycle([_0x1676d4[a1_0x1116('0x28')],_0x36e7c9]);}catch(_0x269c61){return _0x36e7c9;}}function cloudEnabledTasksRunner(_0x37ccb6,_0x12cde9,_0x146a4c){const _0x2209f7={'statuses':{},'scheduledTasks':[],'requests':{},'allTasks':_0x37ccb6};const _0x56218a=_0x12cde9[a1_0x1116('0x28')]===undefined;const _0x1198e9=[];const _0x3abdcd=new message_reporter_1[(a1_0x1116('0x3e'))](_0x12cde9);const _0x4f5de7=createApi(_0x3abdcd,_0x12cde9,_0x2209f7);const _0xed90aa=new end_of_run_message_1[(a1_0x1116('0x3'))](_0x2209f7,_0x1198e9);const _0x253e18=new output_obfuscator_1['OutputObfuscator'](_0x12cde9[a1_0x1116('0x15')]);const _0x1c4411=_0x37ccb6[a1_0x1116('0x19')](_0x465a05=>_0x465a05[a1_0x1116('0x1')])[a1_0x1116('0x39')](_0x81330a=>!!_0x81330a);const _0x2ba3cd=_0x4f5de7[a1_0x1116('0x35')](environment_1[a1_0x1116('0x1e')],_0x1c4411);_0x1c4411[a1_0x1116('0x2c')](_0x67e093=>{_0x2209f7[a1_0x1116('0x29')][_0x67e093]=_0x2ba3cd;});const _0x4bfddf=new Date()['toISOString']();const _0xe639a9=createLifeCycle(_0x2209f7,_0x12cde9,_0x253e18,_0x1198e9);const _0x24c03f=new e2e_encryption_1['E2EEncryption'](environment_1[a1_0x1116('0x32')]||_0x12cde9[a1_0x1116('0x38')]);const _0x3ac84d=new file_storage_1[(a1_0x1116('0x10'))](_0x24c03f);const _0x22053d=new cloud_remote_cache_1[(a1_0x1116('0x1b'))](_0x3abdcd,_0x4f5de7,_0x2209f7,_0x3ac84d);delete process[a1_0x1116('0x1d')][a1_0x1116('0x1e')];const _0x358d2c=tasksRunnerV2(_0x37ccb6,Object['assign'](Object[a1_0x1116('0x2a')]({},_0x12cde9),{'remoteCache':_0x22053d,'lifeCycle':_0xe639a9}),_0x146a4c);if(_0x358d2c[a1_0x1116('0x3f')]){const _0x2eebed=new Subject_1[(a1_0x1116('0x0'))]();_0x358d2c[a1_0x1116('0x3f')]({'next':_0x149284=>_0x2eebed[a1_0x1116('0x16')](_0x149284),'error':_0x150b61=>_0x2eebed[a1_0x1116('0x3b')](_0x150b61),'complete':()=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete(_0xe639a9,_0x12cde9,_0x22053d,_0x4f5de7,_0x253e18,_0x4bfddf,_0x3abdcd,_0xed90aa,_0x1198e9,_0x56218a);_0x2eebed['complete']();})});return _0x2eebed;}else{return _0x358d2c[a1_0x1116('0x37')](_0x182f5b=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete(_0xe639a9,_0x12cde9,_0x22053d,_0x4f5de7,_0x253e18,_0x4bfddf,_0x3abdcd,_0xed90aa,_0x1198e9,_0x56218a);return _0x182f5b;}))['catch'](_0x3dcabf=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete(_0xe639a9,_0x12cde9,_0x22053d,_0x4f5de7,_0x253e18,_0x4bfddf,_0x3abdcd,_0xed90aa,_0x1198e9,_0x56218a);throw _0x3dcabf;}));}}exports[a1_0x1116('0x4')]=cloudEnabledTasksRunner;