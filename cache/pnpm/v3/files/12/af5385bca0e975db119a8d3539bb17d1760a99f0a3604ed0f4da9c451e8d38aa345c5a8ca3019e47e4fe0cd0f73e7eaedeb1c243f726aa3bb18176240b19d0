const a3_0x166b=['createApiAxiosInstance','stack','message','apiError','nxCloudVersion','urls','../../../utilities/axios','axiosException','VERBOSE_LOGGING','stringify','error','then','success','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','slice','response','../../../utilities/metric-logger','data','Run\x20completion\x20responded\x20with\x20`undefined`.','from','status','note','package.json','messages','value','@nrwl/nx-cloud','terminalOutput','endRun','__esModule','/nx-cloud/runs/start','headers','Invalid\x20Nx\x20Cloud\x20response:\x20','mapRespToPerfEntry','extractErrorMessage','recordMetric','axiosMultipleTries','post','Stack\x20Trace:','toString','string','CloudRunApi','../../../utilities/environment','assign','...','defineProperty','gzip','runContext','api','application/octet-stream','next','getBranch','RunEnd.\x20Completed\x20tasks','parse','Run\x20Details:','Invalid\x20end\x20run\x20response','readFileSync','machineInfo','util','RUNNER_FAILURE_PERF_ENTRY','startRun','defaults','__awaiter','done','createMetricRecorder','Invalid\x20end\x20run\x20response:\x20','apiAxiosInstance','../../../utilities/nx-imports','runUrl','zlib','apply'];(function(_0x133f12,_0x166b7f){const _0x47394c=function(_0x333535){while(--_0x333535){_0x133f12['push'](_0x133f12['shift']());}};_0x47394c(++_0x166b7f);}(a3_0x166b,0xb4));const a3_0x4739=function(_0x133f12,_0x166b7f){_0x133f12=_0x133f12-0x0;let _0x47394c=a3_0x166b[_0x133f12];return _0x47394c;};'use strict';var __awaiter=this&&this[a3_0x4739('0x15')]||function(_0xb8dc9c,_0x5256c7,_0x17b54a,_0x3c5943){function _0x3dd760(_0xcaa076){return _0xcaa076 instanceof _0x17b54a?_0xcaa076:new _0x17b54a(function(_0x4efa1c){_0x4efa1c(_0xcaa076);});}return new(_0x17b54a||(_0x17b54a=Promise))(function(_0x24a72c,_0x57cb18){function _0x4041f2(_0x232527){try{_0x24f954(_0x3c5943[a3_0x4739('0x9')](_0x232527));}catch(_0x43cf9a){_0x57cb18(_0x43cf9a);}}function _0x1c1479(_0x1c9306){try{_0x24f954(_0x3c5943['throw'](_0x1c9306));}catch(_0x37f872){_0x57cb18(_0x37f872);}}function _0x24f954(_0x4c3f93){_0x4c3f93[a3_0x4739('0x16')]?_0x24a72c(_0x4c3f93['value']):_0x3dd760(_0x4c3f93[a3_0x4739('0x36')])[a3_0x4739('0x29')](_0x4041f2,_0x1c1479);}_0x24f954((_0x3c5943=_0x3c5943[a3_0x4739('0x1d')](_0xb8dc9c,_0x5256c7||[]))[a3_0x4739('0x9')]());});};Object[a3_0x4739('0x4')](exports,a3_0x4739('0x3a'),{'value':!![]});exports[a3_0x4739('0x0')]=void 0x0;const axios_1=require(a3_0x4739('0x24'));const environment_1=require(a3_0x4739('0x1'));const fs_1=require('fs');const zlib_1=require(a3_0x4739('0x1c'));const util_1=require(a3_0x4739('0x11'));const metric_logger_1=require(a3_0x4739('0x2e'));const {output}=require(a3_0x4739('0x1a'));class CloudRunApi{constructor(_0x603242,_0x2f22b6,_0x52cb5d,_0x1e0caf){this[a3_0x4739('0x35')]=_0x603242;this['runContext']=_0x2f22b6;this['machineInfo']=_0x1e0caf;this[a3_0x4739('0x19')]=(0x0,axios_1[a3_0x4739('0x1e')])(_0x52cb5d);}[a3_0x4739('0x13')](_0x5d00e8,_0x296162){var _0x53595e;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x253922=(0x0,metric_logger_1[a3_0x4739('0x17')])('startRun');try{const _0x49b170={'meta':{'nxCloudVersion':this[a3_0x4739('0x22')]()},'branch':(0x0,environment_1[a3_0x4739('0xa')])(),'runGroup':(0x0,environment_1['getRunGroup'])(),'distributedExecutionId':_0x5d00e8,'hashes':_0x296162};if(environment_1[a3_0x4739('0x26')]){output['note']({'title':'RunStart','bodyLines':['\x0a'+JSON[a3_0x4739('0x27')](_0x49b170,null,0x2)]});}const _0x27711d=yield(0x0,axios_1[a3_0x4739('0x41')])(()=>this[a3_0x4739('0x19')][a3_0x4739('0x42')](a3_0x4739('0x3b'),_0x49b170));_0x253922[a3_0x4739('0x40')]((0x0,metric_logger_1['mapRespToPerfEntry'])(_0x27711d));if(_0x27711d[a3_0x4739('0x2f')]&&_0x27711d['data'][a3_0x4739('0x20')]){this[a3_0x4739('0x35')][a3_0x4739('0x20')]=_0x27711d[a3_0x4739('0x2f')][a3_0x4739('0x20')];}if(!_0x27711d['data']||!_0x27711d[a3_0x4739('0x2f')][a3_0x4739('0x23')]){this[a3_0x4739('0x35')][a3_0x4739('0x21')]=a3_0x4739('0x3d')+JSON[a3_0x4739('0x27')](_0x27711d['data']);return{};}return _0x27711d['data'][a3_0x4739('0x23')];}catch(_0x33ed71){_0x253922['recordMetric'](((_0x53595e=_0x33ed71===null||_0x33ed71===void 0x0?void 0x0:_0x33ed71[a3_0x4739('0x25')])===null||_0x53595e===void 0x0?void 0x0:_0x53595e['response'])?(0x0,metric_logger_1[a3_0x4739('0x3e')])(_0x33ed71[a3_0x4739('0x25')][a3_0x4739('0x2d')]):metric_logger_1[a3_0x4739('0x12')]);this['messages']['apiError']=this[a3_0x4739('0x35')]['extractErrorMessage'](_0x33ed71,a3_0x4739('0x7'));return{};}});}['endRun'](_0xcecd1e,_0x241f32){var _0x1e8eb6,_0x2a2287;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x4739('0x35')][a3_0x4739('0x21')])return![];const _0x46bb33={'meta':{'nxCloudVersion':this[a3_0x4739('0x22')]()},'tasks':_0x241f32,'run':_0xcecd1e,'machineInfo':this[a3_0x4739('0x10')]};const _0x304ee6=Buffer[a3_0x4739('0x31')](JSON[a3_0x4739('0x27')](_0x46bb33));const _0x2d2521=yield(0x0,util_1['promisify'])(zlib_1[a3_0x4739('0x5')])(_0x304ee6);const _0x5c122d=(0x0,metric_logger_1[a3_0x4739('0x17')])(a3_0x4739('0x39'));try{if(environment_1[a3_0x4739('0x26')]){const _0x2b911a=_0x241f32['map'](_0x5a9182=>{return Object[a3_0x4739('0x2')](Object[a3_0x4739('0x2')]({},_0x5a9182),{'terminalOutput':_0x5a9182[a3_0x4739('0x38')]?_0x5a9182[a3_0x4739('0x38')][a3_0x4739('0x2c')](0x0,0x14)+a3_0x4739('0x3'):undefined});});output['note']({'title':a3_0x4739('0xb'),'bodyLines':['\x0a'+JSON[a3_0x4739('0x27')](_0x2b911a,null,0x2)]});}const _0x2bc417=yield(0x0,axios_1[a3_0x4739('0x41')])(()=>this[a3_0x4739('0x19')][a3_0x4739('0x42')]('/nx-cloud/runs/end',_0x2d2521,{'headers':Object[a3_0x4739('0x2')](Object['assign']({},this[a3_0x4739('0x19')][a3_0x4739('0x14')][a3_0x4739('0x3c')]),{'Content-Encoding':a3_0x4739('0x5'),'Content-Type':a3_0x4739('0x8')})}));if(_0x2bc417){_0x5c122d[a3_0x4739('0x40')]((0x0,metric_logger_1['mapRespToPerfEntry'])(_0x2bc417));if(_0x2bc417[a3_0x4739('0x2f')]&&_0x2bc417[a3_0x4739('0x2f')][a3_0x4739('0x1b')]&&_0x2bc417[a3_0x4739('0x2f')][a3_0x4739('0x32')]==='success'){this[a3_0x4739('0x6')][a3_0x4739('0x1b')]=_0x2bc417[a3_0x4739('0x2f')][a3_0x4739('0x1b')];return!![];}if(_0x2bc417[a3_0x4739('0x2f')]&&_0x2bc417['data'][a3_0x4739('0x32')]){this[a3_0x4739('0x35')]['apiError']=a3_0x4739('0x18')+JSON[a3_0x4739('0x27')](_0x2bc417['data'][a3_0x4739('0x20')]);}else if(_0x2bc417[a3_0x4739('0x2f')]&&typeof _0x2bc417[a3_0x4739('0x2f')]===a3_0x4739('0x45')){if(_0x2bc417['data']!==a3_0x4739('0x2a')){this['messages']['apiError']=a3_0x4739('0x18')+JSON[a3_0x4739('0x27')](_0x2bc417[a3_0x4739('0x2f')]);}}else{this['messages']['apiError']=a3_0x4739('0x18')+JSON[a3_0x4739('0x27')](_0x2bc417[a3_0x4739('0x2f')]);}if(environment_1[a3_0x4739('0x26')]){output[a3_0x4739('0x33')]({'title':a3_0x4739('0xe'),'bodyLines':[JSON[a3_0x4739('0x27')](_0x2bc417[a3_0x4739('0x2f')],null,0x2)]});}}else{output[a3_0x4739('0x28')]({'title':a3_0x4739('0x2b'),'bodyLines':[a3_0x4739('0x30'),a3_0x4739('0xd'),JSON['stringify'](_0xcecd1e,null,0x2),a3_0x4739('0x43'),JSON['stringify'](new Error()[a3_0x4739('0x1f')],null,0x2)]});}return![];}catch(_0xaafbd){_0x5c122d[a3_0x4739('0x40')](((_0x1e8eb6=_0xaafbd===null||_0xaafbd===void 0x0?void 0x0:_0xaafbd[a3_0x4739('0x25')])===null||_0x1e8eb6===void 0x0?void 0x0:_0x1e8eb6[a3_0x4739('0x2d')])?(0x0,metric_logger_1[a3_0x4739('0x3e')])(_0xaafbd[a3_0x4739('0x25')]['response']):metric_logger_1[a3_0x4739('0x12')]);const _0x12b624=(_0x2a2287=_0xaafbd[a3_0x4739('0x25')])!==null&&_0x2a2287!==void 0x0?_0x2a2287:_0xaafbd;this[a3_0x4739('0x35')][a3_0x4739('0x21')]=this[a3_0x4739('0x35')][a3_0x4739('0x3f')](_0x12b624,'api');return![];}});}[a3_0x4739('0x22')](){try{const _0x2bd4fa=JSON[a3_0x4739('0xc')]((0x0,fs_1[a3_0x4739('0xf')])(a3_0x4739('0x34'))[a3_0x4739('0x44')]());return _0x2bd4fa['devDependencies'][a3_0x4739('0x37')];}catch(_0xa3c9a0){return'unknown';}}}exports[a3_0x4739('0x0')]=CloudRunApi;