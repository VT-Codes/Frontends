const a7_0x3f4e=['DistributedExecutionApi','toString','note','projectGraph','hash','then','tasks','../../../utilities/create-no-new-messages-timeout','copyFilesFromCache','rxjs/internal/Observable','strip-json-comments','commandStatus','../../../utilities/waiter','defaultTargetDependencies','../../../utilities/nx-imports','build','assign','Command\x20execution\x20failed.','Main\x20job\x20terminated\x20with\x20an\x20error:\x20\x22','See\x20run\x20details\x20at\x20','Found\x20unknown\x20task:\x20','Unable\x20to\x20complete\x20a\x20run.','startTask','finally','runUrl','error:\x20','size','wait','projects','createTaskGraph','map','delete','apply','endTask','throw','E2EEncryption','VERBOSE_LOGGING','configuration','getRunGroup','keys','FileStorage','axiosException','strictlyOrderedTargets','criticalErrorMessage','url','targetDependencies','Retrieving\x20artifacts\x20from\x20','Distributed\x20Execution\x20Terminated','executionId:\x20','log','findTask','message','next','dependencies','completedTasks','addVerticalSeparator','splitTasksIntoStages','Successfully\x20completed\x20running\x20the\x20command.','addTaskToGraph','Waiting...','createStartRequest','../../error/print-run-group-error','defineProperty','executionStatus:\x20','lifeCycle','has','TaskGraphCreator','Extracting\x20artifacts','value','nxCloudDistributedTasksRunner','parse','run','start','readFileSync','taskId','project','self','write','ENCRYPTION_KEY','exit','addTaskDependencies','stdout','target','error','addDependencies','executionStatus','./node_modules/.cache/nx','reset','__esModule','./distributed-execution.api','indexOf','Waiter','find','push','number\x20of\x20completed\x20tasks:\x20','../../../utilities/environment','catch','cacheDirectory','length'];(function(_0x1d7e59,_0x3f4e6f){const _0xf4be07=function(_0x58dab1){while(--_0x58dab1){_0x1d7e59['push'](_0x1d7e59['shift']());}};_0xf4be07(++_0x3f4e6f);}(a7_0x3f4e,0xdf));const a7_0xf4be=function(_0x1d7e59,_0x3f4e6f){_0x1d7e59=_0x1d7e59-0x0;let _0xf4be07=a7_0x3f4e[_0x1d7e59];return _0xf4be07;};'use strict';var __awaiter=this&&this['__awaiter']||function(_0x6047ce,_0xc2ee74,_0x20f7e0,_0x56e927){function _0x54705b(_0xaa4f62){return _0xaa4f62 instanceof _0x20f7e0?_0xaa4f62:new _0x20f7e0(function(_0x395725){_0x395725(_0xaa4f62);});}return new(_0x20f7e0||(_0x20f7e0=Promise))(function(_0x5b31c4,_0x135157){function _0x545a5a(_0x1f44c7){try{_0x33c5cb(_0x56e927[a7_0xf4be('0x1b')](_0x1f44c7));}catch(_0x3a22c7){_0x135157(_0x3a22c7);}}function _0x2044d4(_0x33c400){try{_0x33c5cb(_0x56e927[a7_0xf4be('0x9')](_0x33c400));}catch(_0x162b49){_0x135157(_0x162b49);}}function _0x33c5cb(_0x4d8ee9){_0x4d8ee9['done']?_0x5b31c4(_0x4d8ee9['value']):_0x54705b(_0x4d8ee9[a7_0xf4be('0x2b')])['then'](_0x545a5a,_0x2044d4);}_0x33c5cb((_0x56e927=_0x56e927[a7_0xf4be('0x7')](_0x6047ce,_0xc2ee74||[]))[a7_0xf4be('0x1b')]());});};Object[a7_0xf4be('0x25')](exports,a7_0xf4be('0x3f'),{'value':!![]});exports[a7_0xf4be('0x29')]=exports[a7_0xf4be('0x2c')]=void 0x0;const Observable_1=require(a7_0xf4be('0x53'));const stripJsonComments=require(a7_0xf4be('0x54'));const fs_1=require('fs');const distributed_execution_api_1=require(a7_0xf4be('0x40'));const file_storage_1=require('../../file-storage/file-storage');const e2e_encryption_1=require('../../file-storage/e2e-encryption');const waiter_1=require(a7_0xf4be('0x56'));const environment_1=require(a7_0xf4be('0x46'));const print_run_group_error_1=require(a7_0xf4be('0x24'));const create_no_new_messages_timeout_1=require(a7_0xf4be('0x51'));const metric_logger_1=require('../../../utilities/metric-logger');const {output,getDependencyConfigs,getOutputs,unparse,Cache}=require(a7_0xf4be('0x58'));class NoopLifeCycle{['scheduleTask'](_0x1fb99a){}[a7_0xf4be('0x60')](_0x1e5247){}[a7_0xf4be('0x8')](_0x113a87,_0xc3efe5){}}function runDistributedExecution(_0x3a857e,_0x133e20,_0x2c762,_0x6cff76,_0x3ac3a1,_0x862bac,_0xe49869){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x56f861=JSON[a7_0xf4be('0x2d')](stripJsonComments((0x0,fs_1[a7_0xf4be('0x30')])('nx.json')[a7_0xf4be('0x4b')]()));const _0x16bed1=new TaskOrderer(_0x2c762['projectGraph'],getDefaultDependencyConfigs(_0x56f861,_0x133e20))[a7_0xf4be('0x1f')](_0xe49869);const _0x108314=yield _0x3a857e[a7_0xf4be('0x2f')]((0x0,distributed_execution_api_1[a7_0xf4be('0x23')])(_0x862bac,_0x16bed1,_0x133e20));return yield processTasks(_0x3a857e,_0x6cff76,_0x3ac3a1,_0x133e20,_0x108314,_0xe49869,_0x2c762);});}function processTasks(_0x5d4a2e,_0xf7a3cc,_0xc07abb,_0xb54096,_0xd555e0,_0x390dfd,_0x52009f){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1faea3={};const _0x5c1248=(0x0,create_no_new_messages_timeout_1['createNoNewMessagesTimeout'])();const _0x2d7fbc=new waiter_1[(a7_0xf4be('0x42'))]();while(!![]){if(environment_1[a7_0xf4be('0xb')]){output['note']({'title':a7_0xf4be('0x22')});}yield _0x2d7fbc[a7_0xf4be('0x2')]();const _0xa7dca=yield _0x5d4a2e['status'](_0xd555e0);if(environment_1['VERBOSE_LOGGING']){output[a7_0xf4be('0x4c')]({'title':'Status\x20update','bodyLines':[a7_0xf4be('0x17')+_0xd555e0,a7_0xf4be('0x26')+_0xa7dca[a7_0xf4be('0x3c')],a7_0xf4be('0x45')+_0xa7dca[a7_0xf4be('0x1d')][a7_0xf4be('0x49')],a7_0xf4be('0x0')+_0xa7dca['criticalErrorMessage']]});}if(_0xa7dca[a7_0xf4be('0x12')]){output[a7_0xf4be('0x3a')]({'title':a7_0xf4be('0x16'),'bodyLines':['Error:',_0xa7dca[a7_0xf4be('0x12')]]});process['exit'](0x1);}_0x5c1248(_0xa7dca['completedTasks'][a7_0xf4be('0x49')]);for(const _0x6038b1 of _0xa7dca[a7_0xf4be('0x1d')]){if(_0x1faea3[_0x6038b1['taskId']])continue;yield processTask(_0xf7a3cc,_0xc07abb,_0x52009f,_0xb54096,_0x390dfd,_0x6038b1);_0x2d7fbc[a7_0xf4be('0x3e')]();_0x1faea3[_0x6038b1[a7_0xf4be('0x31')]]=!![];}if(_0xa7dca[a7_0xf4be('0x3c')]==='COMPLETED'){return{'commandStatus':_0xa7dca[a7_0xf4be('0x55')],'runUrl':_0xa7dca['runUrl']};}}});}function processTask(_0x5afe9d,_0x31f41f,_0x4e19c9,_0x3943ce,_0x42e747,_0x15d15b){return __awaiter(this,void 0x0,void 0x0,function*(){if(environment_1['VERBOSE_LOGGING']){output[a7_0xf4be('0x4c')]({'title':'Processing\x20task\x20'+_0x15d15b[a7_0xf4be('0x31')]});}const _0xc30c3e=_0x42e747[a7_0xf4be('0x43')](_0x41c54c=>_0x15d15b[a7_0xf4be('0x31')]===_0x41c54c['id']);if(!_0xc30c3e){throw new Error(a7_0xf4be('0x5e')+_0x15d15b[a7_0xf4be('0x31')]);}if(environment_1[a7_0xf4be('0xb')]){output[a7_0xf4be('0x4c')]({'title':a7_0xf4be('0x15')+_0x15d15b[a7_0xf4be('0x13')]});}yield _0x5afe9d['retrieve'](_0x15d15b[a7_0xf4be('0x4e')],_0x15d15b[a7_0xf4be('0x13')],_0x3943ce[a7_0xf4be('0x48')]||a7_0xf4be('0x3d'));const _0x12a63d=yield _0x31f41f['get'](Object[a7_0xf4be('0x5a')](Object[a7_0xf4be('0x5a')]({},_0xc30c3e),{'hash':_0x15d15b[a7_0xf4be('0x4e')]}));const _0x1f65df=getOutputs(_0x4e19c9[a7_0xf4be('0x4d')]['nodes'],_0xc30c3e);if(environment_1['VERBOSE_LOGGING']){output[a7_0xf4be('0x4c')]({'title':a7_0xf4be('0x2a'),'bodyLines':_0x1f65df});}yield _0x31f41f[a7_0xf4be('0x52')](_0x15d15b[a7_0xf4be('0x4e')],_0x12a63d,_0x1f65df);output['logCommand'](getCommand(_0xc30c3e));process[a7_0xf4be('0x38')][a7_0xf4be('0x34')](_0x12a63d['terminalOutput']);output[a7_0xf4be('0x1e')]();});}function getCommand(_0x7d0729){const _0x39a5b8=unparse(_0x7d0729['overrides']||{});const _0x5d1963=_0x7d0729[a7_0xf4be('0x39')]['configuration']?':'+_0x7d0729[a7_0xf4be('0x39')][a7_0xf4be('0xc')]:'';return['nx',a7_0xf4be('0x2e'),_0x7d0729['target'][a7_0xf4be('0x32')]+':'+_0x7d0729[a7_0xf4be('0x39')][a7_0xf4be('0x39')]+_0x5d1963,..._0x39a5b8]['join']('\x20');}const nxCloudDistributedTasksRunner=(_0x5c4f42,_0x5ede21,_0x36b762)=>{if(environment_1['VERBOSE_LOGGING']){output[a7_0xf4be('0x4c')]({'title':'Starting\x20distributed\x20command\x20execution'});}_0x5ede21[a7_0xf4be('0x27')]=new NoopLifeCycle();const _0x4a75c5=(0x0,environment_1[a7_0xf4be('0xd')])();if(!_0x4a75c5){(0x0,print_run_group_error_1['printRunGroupError'])();return process['exit'](0x1);}const _0x1fd785=new e2e_encryption_1[(a7_0xf4be('0xa'))](environment_1[a7_0xf4be('0x35')]||_0x5ede21['encryptionKey']);const _0x30420a=new file_storage_1[(a7_0xf4be('0xf'))](_0x1fd785);const _0x507f21=new Cache(_0x5ede21);const _0x39eac7=new distributed_execution_api_1[(a7_0xf4be('0x4a'))](_0x5ede21);runDistributedExecution(_0x39eac7,_0x5ede21,_0x36b762,_0x30420a,_0x507f21,_0x4a75c5,_0x5c4f42)[a7_0xf4be('0x4f')](_0x49e6fb=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){if(_0x49e6fb[a7_0xf4be('0x55')]===0x0){output['success']({'title':a7_0xf4be('0x20'),'bodyLines':[a7_0xf4be('0x5d')+_0x49e6fb[a7_0xf4be('0x62')]]});}else{output[a7_0xf4be('0x3a')]({'title':a7_0xf4be('0x5b'),'bodyLines':['See\x20run\x20details\x20at\x20'+_0x49e6fb[a7_0xf4be('0x62')]]});}yield(0x0,metric_logger_1['submitRunMetrics'])(_0x5ede21);process[a7_0xf4be('0x36')](_0x49e6fb[a7_0xf4be('0x55')]);}))[a7_0xf4be('0x47')](_0x1ead83=>{output[a7_0xf4be('0x3a')]({'title':a7_0xf4be('0x5f'),'bodyLines':[_0x1ead83[a7_0xf4be('0x1a')]]});if(_0x1ead83[a7_0xf4be('0x10')]){console['log'](_0x1ead83[a7_0xf4be('0x10')]);}else{console[a7_0xf4be('0x18')](_0x1ead83);}_0x39eac7['completeRunGroupWithError'](_0x4a75c5,a7_0xf4be('0x5c')+_0x1ead83[a7_0xf4be('0x1a')]+'\x22')[a7_0xf4be('0x61')](()=>process['exit'](0x1));});return new Observable_1['Observable'](()=>{});};exports[a7_0xf4be('0x2c')]=nxCloudDistributedTasksRunner;class TaskOrderer{constructor(_0x29efce,_0x1c9ce2){this[a7_0xf4be('0x4d')]=_0x29efce;this[a7_0xf4be('0x57')]=_0x1c9ce2;}[a7_0xf4be('0x1f')](_0x1af631){if(_0x1af631[a7_0xf4be('0x49')]===0x0)return[];const _0x52e5d1=[];const _0x102fe5=this[a7_0xf4be('0x4')](_0x1af631);const _0x5afcb6=new Set(_0x1af631[a7_0xf4be('0x5')](_0x5aae2a=>_0x5aae2a['id']));let _0x5ceb79=0x0;while(_0x5afcb6[a7_0xf4be('0x1')]>0x0){const _0x138476=_0x52e5d1[_0x5ceb79]=[];for(const _0x2142e4 of _0x5afcb6){let _0x7e9c3=!![];for(const _0xa0ca7f of _0x102fe5[a7_0xf4be('0x1c')][_0x2142e4]){if(_0x5afcb6['has'](_0xa0ca7f)){_0x7e9c3=![];break;}}if(!_0x7e9c3){continue;}const _0x3a3c92=_0x102fe5[a7_0xf4be('0x50')][_0x2142e4];_0x138476[a7_0xf4be('0x44')](_0x3a3c92);}for(const _0x33e810 of _0x138476){_0x5afcb6[a7_0xf4be('0x6')](_0x33e810['id']);}_0x5ceb79++;}return _0x52e5d1;}['createTaskGraph'](_0x5e41c1){const _0xce56de=new TaskGraphCreator(this['projectGraph'],this['defaultTargetDependencies']);return _0xce56de[a7_0xf4be('0x4')](_0x5e41c1);}}class TaskGraphCreator{constructor(_0x26db27,_0x2a79d2){this[a7_0xf4be('0x4d')]=_0x26db27;this[a7_0xf4be('0x57')]=_0x2a79d2;}[a7_0xf4be('0x4')](_0x5cb907){const _0x17e342={'roots':[],'tasks':{},'dependencies':{}};for(const _0x3f2c0c of _0x5cb907){this[a7_0xf4be('0x21')](_0x3f2c0c,_0x17e342);const _0x51874d=getDependencyConfigs(_0x3f2c0c[a7_0xf4be('0x39')],this[a7_0xf4be('0x57')],this[a7_0xf4be('0x4d')]);if(!_0x51874d){continue;}this[a7_0xf4be('0x37')](_0x3f2c0c,_0x51874d,_0x5cb907,_0x17e342);}_0x17e342['roots']=Object[a7_0xf4be('0xe')](_0x17e342[a7_0xf4be('0x1c')])['filter'](_0x362cf7=>_0x17e342['dependencies'][_0x362cf7][a7_0xf4be('0x49')]===0x0);return _0x17e342;}['addTaskDependencies'](_0x7438be,_0x4dec48,_0x530283,_0x5dda61){for(const _0x47da68 of _0x4dec48){if(_0x47da68[a7_0xf4be('0x3')]===a7_0xf4be('0x33')){for(const _0x24f03e of _0x530283){if(_0x24f03e[a7_0xf4be('0x39')][a7_0xf4be('0x32')]===_0x7438be[a7_0xf4be('0x39')][a7_0xf4be('0x32')]&&_0x24f03e[a7_0xf4be('0x39')]['target']===_0x47da68[a7_0xf4be('0x39')]){_0x5dda61[a7_0xf4be('0x1c')][_0x7438be['id']][a7_0xf4be('0x44')](_0x24f03e['id']);}}}else if(_0x47da68[a7_0xf4be('0x3')]===a7_0xf4be('0x1c')){const _0x12ad4d=new Set();this[a7_0xf4be('0x3b')](_0x7438be['target'][a7_0xf4be('0x32')],_0x47da68[a7_0xf4be('0x39')],_0x530283,_0x5dda61,_0x7438be['id'],_0x12ad4d);}}}[a7_0xf4be('0x3b')](_0x1c0c47,_0x4832d6,_0x1ac5e9,_0x321956,_0x388004,_0x380bc3){_0x380bc3['add'](_0x1c0c47);const _0xf62394=this[a7_0xf4be('0x4d')]['dependencies'][_0x1c0c47];if(_0xf62394){const _0x115ba4=_0xf62394[a7_0xf4be('0x5')](_0x330dff=>_0x330dff[a7_0xf4be('0x39')]);for(const _0x2bdc18 of _0x115ba4){if(_0x380bc3[a7_0xf4be('0x28')](_0x2bdc18)){continue;}const _0x3c7dad=this[a7_0xf4be('0x19')]({'project':_0x2bdc18,'target':_0x4832d6},_0x1ac5e9);if(_0x3c7dad){if(_0x321956[a7_0xf4be('0x1c')][_0x388004][a7_0xf4be('0x41')](_0x3c7dad['id'])===-0x1){_0x321956[a7_0xf4be('0x1c')][_0x388004][a7_0xf4be('0x44')](_0x3c7dad['id']);}}else{this[a7_0xf4be('0x3b')](_0x2bdc18,_0x4832d6,_0x1ac5e9,_0x321956,_0x388004,_0x380bc3);}}}}[a7_0xf4be('0x19')]({project,target},_0x54e116){return _0x54e116[a7_0xf4be('0x43')](_0x294134=>_0x294134['target'][a7_0xf4be('0x32')]===project&&_0x294134[a7_0xf4be('0x39')]['target']===target);}['addTaskToGraph'](_0x2314dc,_0x5c6678){_0x5c6678['tasks'][_0x2314dc['id']]=_0x2314dc;_0x5c6678[a7_0xf4be('0x1c')][_0x2314dc['id']]=[];}}exports[a7_0xf4be('0x29')]=TaskGraphCreator;function getDefaultDependencyConfigs(_0x1d1ca9,_0x437115){var _0x353d1d,_0x33d29a;const _0x2ba1a8=(_0x353d1d=_0x1d1ca9[a7_0xf4be('0x14')])!==null&&_0x353d1d!==void 0x0?_0x353d1d:{};const _0x2a0496=_0x437115?(_0x33d29a=_0x437115[a7_0xf4be('0x11')])!==null&&_0x33d29a!==void 0x0?_0x33d29a:[a7_0xf4be('0x59')]:[];for(const _0xb357ee of _0x2a0496){_0x2ba1a8[_0xb357ee]=_0x2ba1a8[_0xb357ee]||[];_0x2ba1a8[_0xb357ee][a7_0xf4be('0x44')]({'target':_0xb357ee,'projects':a7_0xf4be('0x1c')});}return _0x2ba1a8;}