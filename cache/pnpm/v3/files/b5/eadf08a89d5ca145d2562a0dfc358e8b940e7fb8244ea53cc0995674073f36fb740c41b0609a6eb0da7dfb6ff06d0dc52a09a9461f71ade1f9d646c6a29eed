{"version":3,"file":"react-click-away-listener.js","sources":["../src/index.tsx"],"sourcesContent":["import React, {\n\tuseRef,\n\tuseEffect,\n\tRefCallback,\n\tcloneElement,\n\tReactElement,\n\tHTMLAttributes,\n\tMutableRefObject,\n\tFunctionComponent\n} from 'react';\n\ntype FocusEvents = 'focusin' | 'focusout';\ntype MouseEvents = 'click' | 'mousedown' | 'mouseup';\ntype TouchEvents = 'touchstart' | 'touchend';\ntype Events = FocusEvent | MouseEvent | TouchEvent;\n\ninterface Props extends HTMLAttributes<HTMLElement> {\n\tonClickAway: (event: Events) => void;\n\tfocusEvent?: FocusEvents;\n\tmouseEvent?: MouseEvents;\n\ttouchEvent?: TouchEvents;\n\tchildren: ReactElement<any>;\n}\n\nconst eventTypeMapping = {\n\tclick: 'onClick',\n\tfocusin: 'onFocus',\n\tfocusout: 'onFocus',\n\tmousedown: 'onMouseDown',\n\tmouseup: 'onMouseUp',\n\ttouchstart: 'onTouchStart',\n\ttouchend: 'onTouchEnd'\n};\n\nconst ClickAwayListener: FunctionComponent<Props> = ({\n\tchildren,\n\tonClickAway,\n\tfocusEvent = 'focusin',\n\tmouseEvent = 'click',\n\ttouchEvent = 'touchend'\n}) => {\n\tconst node = useRef<HTMLElement | null>(null);\n\tconst bubbledEventTarget = useRef<EventTarget | null>(null);\n\tconst mountedRef = useRef(false);\n\n\t/**\n\t * Prevents the bubbled event from getting triggered immediately\n\t * https://github.com/facebook/react/issues/20074\n\t */\n\tuseEffect(() => {\n\t\tsetTimeout(() => {\n\t\t\tmountedRef.current = true;\n\t\t}, 0);\n\n\t\treturn () => {\n\t\t\tmountedRef.current = false;\n\t\t};\n\t}, []);\n\n\tconst handleBubbledEvents =\n\t\t(type: string) =>\n\t\t(event: Events): void => {\n\t\t\tbubbledEventTarget.current = event.target;\n\n\t\t\tconst handler = children?.props[type];\n\n\t\t\tif (handler) {\n\t\t\t\thandler(event);\n\t\t\t}\n\t\t};\n\n\tconst handleChildRef = (childRef: HTMLElement) => {\n\t\tnode.current = childRef;\n\n\t\tlet { ref } = children as typeof children & {\n\t\t\tref: RefCallback<HTMLElement> | MutableRefObject<HTMLElement>;\n\t\t};\n\n\t\tif (typeof ref === 'function') {\n\t\t\tref(childRef);\n\t\t} else if (ref) {\n\t\t\tref.current = childRef;\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tconst handleEvents = (event: Events): void => {\n\t\t\tif (!mountedRef.current) return;\n\n\t\t\tif (\n\t\t\t\t(node.current && node.current.contains(event.target as Node)) ||\n\t\t\t\tbubbledEventTarget.current === event.target ||\n\t\t\t\t!document.contains(event.target as Node)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tonClickAway(event);\n\t\t};\n\n\t\tdocument.addEventListener(mouseEvent, handleEvents);\n\t\tdocument.addEventListener(touchEvent, handleEvents);\n\t\tdocument.addEventListener(focusEvent, handleEvents);\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(mouseEvent, handleEvents);\n\t\t\tdocument.removeEventListener(touchEvent, handleEvents);\n\t\t\tdocument.removeEventListener(focusEvent, handleEvents);\n\t\t};\n\t}, [focusEvent, mouseEvent, onClickAway, touchEvent]);\n\n\tconst mappedMouseEvent = eventTypeMapping[mouseEvent];\n\tconst mappedTouchEvent = eventTypeMapping[touchEvent];\n\tconst mappedFocusEvent = eventTypeMapping[focusEvent];\n\n\treturn React.Children.only(\n\t\tcloneElement(children as ReactElement<any>, {\n\t\t\tref: handleChildRef,\n\t\t\t[mappedFocusEvent]: handleBubbledEvents(mappedFocusEvent),\n\t\t\t[mappedMouseEvent]: handleBubbledEvents(mappedMouseEvent),\n\t\t\t[mappedTouchEvent]: handleBubbledEvents(mappedTouchEvent)\n\t\t})\n\t);\n};\n\nClickAwayListener.displayName = 'ClickAwayListener';\n\nexport default ClickAwayListener;\n"],"names":["eventTypeMapping","click","focusin","focusout","mousedown","mouseup","touchstart","touchend","ClickAwayListener","_ref","_cloneElement","children","onClickAway","_ref$focusEvent","focusEvent","_ref$mouseEvent","mouseEvent","_ref$touchEvent","touchEvent","node","useRef","bubbledEventTarget","mountedRef","useEffect","setTimeout","current","handleBubbledEvents","type","event","target","handler","props","handleEvents","contains","document","addEventListener","removeEventListener","mappedMouseEvent","mappedTouchEvent","mappedFocusEvent","React","Children","only","cloneElement","ref","childRef","_defineProperty","displayName"],"mappings":"+OAwBA,IAAMA,EAAmB,CACxBC,MAAO,UACPC,QAAS,UACTC,SAAU,UACVC,UAAW,cACXC,QAAS,YACTC,WAAY,eACZC,SAAU,cAGLC,EAA8C,SAM9CC,GAAA,IAAAC,EALLC,IAAAA,SACAC,IAAAA,YAIKC,EAAAJ,EAHLK,WAAAA,aAAa,UAGRD,EAAAE,EAAAN,EAFLO,WAAAA,aAAa,QAERD,EAAAE,EAAAR,EADLS,WAAAA,aAAa,WACRD,EACCE,EAAOC,SAA2B,MAClCC,EAAqBD,SAA2B,MAChDE,EAAaF,UAAO,GAM1BG,EAAAA,WAAU,WAKT,OAJAC,YAAW,WACVF,EAAWG,SAAU,IACnB,GAEI,WACNH,EAAWG,SAAU,KAEpB,IAEH,IAAMC,EACL,SAACC,GACD,OAAA,SAACC,GACAP,EAAmBI,QAAUG,EAAMC,OAE7BC,IAAAA,EAAUnB,MAAAA,OAAAA,EAAAA,EAAUoB,MAAMJ,GAE5BG,GACHA,EAAQF,KAkBXL,EAAAA,WAAU,WACT,IAAMS,EAAe,SAACJ,GAChBN,EAAWG,UAGdN,EAAKM,SAAWN,EAAKM,QAAQQ,SAASL,EAAMC,SAC7CR,EAAmBI,UAAYG,EAAMC,SACpCK,SAASD,SAASL,EAAMC,SAK1BjB,EAAYgB,KAOb,OAJAM,SAASC,iBAAiBnB,EAAYgB,GACtCE,SAASC,iBAAiBjB,EAAYc,GACtCE,SAASC,iBAAiBrB,EAAYkB,GAE/B,WACNE,SAASE,oBAAoBpB,EAAYgB,GACzCE,SAASE,oBAAoBlB,EAAYc,GACzCE,SAASE,oBAAoBtB,EAAYkB,MAExC,CAAClB,EAAYE,EAAYJ,EAAaM,IAEzC,IAAMmB,EAAmBrC,EAAiBgB,GACpCsB,EAAmBtC,EAAiBkB,GACpCqB,EAAmBvC,EAAiBc,GAEnC0B,OAAAA,EAAAA,QAAMC,SAASC,KACrBC,EAAAA,aAAahC,GAEX4B,EAFU7B,EAAA,CACXkC,IA9CqB,SAACC,GACvB1B,EAAKM,QAAUoB,EAEf,IAAMD,EAAQjC,EAARiC,IAIa,mBAARA,EACVA,EAAIC,GACMD,IACVA,EAAInB,QAAUoB,KAqCbN,EAAmBb,EAAoBa,IAF7BO,EAAApC,EAGV2B,EAAmBX,EAAoBW,QACvCC,EAAmBZ,EAAoBY,IAJ7B5B,MASdF,EAAkBuC,YAAc"}