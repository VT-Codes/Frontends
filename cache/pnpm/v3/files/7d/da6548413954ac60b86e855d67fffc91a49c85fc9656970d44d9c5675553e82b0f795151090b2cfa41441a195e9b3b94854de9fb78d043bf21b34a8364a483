const a3_0x2452=['util','Invalid\x20end\x20run\x20response:\x20','package.json','extractErrorMessage','unknown','apiAxiosInstance','defaults','zlib','/nx-cloud/runs/start','toString','success','../../../utilities/metric-logger','getRunGroup','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','Run\x20Details:','urls','throw','gzip','getBranch','parse','done','nxCloudVersion','post','createMetricRecorder','terminalOutput','../../../utilities/axios','map','startRun','@nrwl/nx-cloud','defineProperty','headers','apiError','data','apply','createApiAxiosInstance','value','machineInfo','note','assign','runContext','axiosException','CloudRunApi','from','messages','__awaiter','next','stack','RUNNER_FAILURE_PERF_ENTRY','Run\x20completion\x20responded\x20with\x20`undefined`.','/nx-cloud/runs/end','Invalid\x20Nx\x20Cloud\x20response:\x20','mapRespToPerfEntry','../../../utilities/environment','endRun','stringify','runUrl','status','response','Stack\x20Trace:','recordMetric','message','then','promisify','VERBOSE_LOGGING'];(function(_0x35ab4f,_0x2452ce){const _0x3ca8b0=function(_0x2ab590){while(--_0x2ab590){_0x35ab4f['push'](_0x35ab4f['shift']());}};_0x3ca8b0(++_0x2452ce);}(a3_0x2452,0x145));const a3_0x3ca8=function(_0x35ab4f,_0x2452ce){_0x35ab4f=_0x35ab4f-0x0;let _0x3ca8b0=a3_0x2452[_0x35ab4f];return _0x3ca8b0;};'use strict';var __awaiter=this&&this[a3_0x3ca8('0x27')]||function(_0x3f8208,_0x27cfb3,_0x1ca2d0,_0x18bde9){function _0x24e567(_0x16b30c){return _0x16b30c instanceof _0x1ca2d0?_0x16b30c:new _0x1ca2d0(function(_0x127c88){_0x127c88(_0x16b30c);});}return new(_0x1ca2d0||(_0x1ca2d0=Promise))(function(_0x11ad00,_0x4f75b6){function _0x44f5f6(_0x549f9a){try{_0x3023b3(_0x18bde9[a3_0x3ca8('0x28')](_0x549f9a));}catch(_0x23771a){_0x4f75b6(_0x23771a);}}function _0x783f3f(_0x2370db){try{_0x3023b3(_0x18bde9[a3_0x3ca8('0xb')](_0x2370db));}catch(_0xe2e4ed){_0x4f75b6(_0xe2e4ed);}}function _0x3023b3(_0x4c10a3){_0x4c10a3[a3_0x3ca8('0xf')]?_0x11ad00(_0x4c10a3[a3_0x3ca8('0x1e')]):_0x24e567(_0x4c10a3[a3_0x3ca8('0x1e')])[a3_0x3ca8('0x38')](_0x44f5f6,_0x783f3f);}_0x3023b3((_0x18bde9=_0x18bde9[a3_0x3ca8('0x1c')](_0x3f8208,_0x27cfb3||[]))[a3_0x3ca8('0x28')]());});};Object[a3_0x3ca8('0x18')](exports,'__esModule',{'value':!![]});exports[a3_0x3ca8('0x24')]=void 0x0;const axios_1=require(a3_0x3ca8('0x14'));const environment_1=require(a3_0x3ca8('0x2f'));const fs_1=require('fs');const zlib_1=require(a3_0x3ca8('0x2'));const util_1=require(a3_0x3ca8('0x3b'));const metric_logger_1=require(a3_0x3ca8('0x6'));const {output}=require('../../../utilities/nx-imports');class CloudRunApi{constructor(_0x2eabb4,_0x441e4b,_0xd93b1d,_0x16c05b){this['messages']=_0x2eabb4;this[a3_0x3ca8('0x22')]=_0x441e4b;this[a3_0x3ca8('0x1f')]=_0x16c05b;this[a3_0x3ca8('0x0')]=(0x0,axios_1[a3_0x3ca8('0x1d')])(_0xd93b1d);}[a3_0x3ca8('0x16')](_0x530f39,_0x2b74f9){var _0x38fbed;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x331f35=(0x0,metric_logger_1[a3_0x3ca8('0x12')])(a3_0x3ca8('0x16'));try{const _0x599680={'meta':{'nxCloudVersion':this[a3_0x3ca8('0x10')]()},'branch':(0x0,environment_1[a3_0x3ca8('0xd')])(),'runGroup':(0x0,environment_1[a3_0x3ca8('0x7')])(),'distributedExecutionId':_0x530f39,'hashes':_0x2b74f9};if(environment_1['VERBOSE_LOGGING']){output['note']({'title':'RunStart','bodyLines':['\x0a'+JSON['stringify'](_0x599680,null,0x2)]});}const _0x3b7669=yield(0x0,axios_1['axiosMultipleTries'])(()=>this[a3_0x3ca8('0x0')][a3_0x3ca8('0x11')](a3_0x3ca8('0x3'),_0x599680));_0x331f35[a3_0x3ca8('0x36')]((0x0,metric_logger_1[a3_0x3ca8('0x2e')])(_0x3b7669));if(_0x3b7669[a3_0x3ca8('0x1b')]&&_0x3b7669['data'][a3_0x3ca8('0x37')]){this['messages'][a3_0x3ca8('0x37')]=_0x3b7669['data']['message'];}if(!_0x3b7669[a3_0x3ca8('0x1b')]||!_0x3b7669[a3_0x3ca8('0x1b')][a3_0x3ca8('0xa')]){this[a3_0x3ca8('0x26')][a3_0x3ca8('0x1a')]=a3_0x3ca8('0x2d')+JSON[a3_0x3ca8('0x31')](_0x3b7669[a3_0x3ca8('0x1b')]);return{};}return _0x3b7669['data'][a3_0x3ca8('0xa')];}catch(_0x6daa53){_0x331f35[a3_0x3ca8('0x36')](((_0x38fbed=_0x6daa53===null||_0x6daa53===void 0x0?void 0x0:_0x6daa53[a3_0x3ca8('0x23')])===null||_0x38fbed===void 0x0?void 0x0:_0x38fbed[a3_0x3ca8('0x34')])?(0x0,metric_logger_1[a3_0x3ca8('0x2e')])(_0x6daa53[a3_0x3ca8('0x23')][a3_0x3ca8('0x34')]):metric_logger_1[a3_0x3ca8('0x2a')]);this[a3_0x3ca8('0x26')]['apiError']=this[a3_0x3ca8('0x26')][a3_0x3ca8('0x3e')](_0x6daa53,'api');return{};}});}[a3_0x3ca8('0x30')](_0xdb7504,_0x5b3b9c){var _0x9637dd,_0x59e317;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x3ca8('0x26')][a3_0x3ca8('0x1a')])return![];const _0x281056={'meta':{'nxCloudVersion':this['nxCloudVersion']()},'tasks':_0x5b3b9c,'run':_0xdb7504,'machineInfo':this[a3_0x3ca8('0x1f')]};const _0x11bc95=Buffer[a3_0x3ca8('0x25')](JSON[a3_0x3ca8('0x31')](_0x281056));const _0x1ef111=yield(0x0,util_1[a3_0x3ca8('0x39')])(zlib_1[a3_0x3ca8('0xc')])(_0x11bc95);const _0x4c0438=(0x0,metric_logger_1['createMetricRecorder'])(a3_0x3ca8('0x30'));try{if(environment_1[a3_0x3ca8('0x3a')]){const _0x4934c5=_0x5b3b9c[a3_0x3ca8('0x15')](_0x4a6882=>{return Object['assign'](Object[a3_0x3ca8('0x21')]({},_0x4a6882),{'terminalOutput':_0x4a6882[a3_0x3ca8('0x13')]?_0x4a6882[a3_0x3ca8('0x13')]['slice'](0x0,0x14)+'...':undefined});});output[a3_0x3ca8('0x20')]({'title':'RunEnd.\x20Completed\x20tasks','bodyLines':['\x0a'+JSON[a3_0x3ca8('0x31')](_0x4934c5,null,0x2)]});}const _0x570f27=yield(0x0,axios_1['axiosMultipleTries'])(()=>this[a3_0x3ca8('0x0')]['post'](a3_0x3ca8('0x2c'),_0x1ef111,{'headers':Object[a3_0x3ca8('0x21')](Object[a3_0x3ca8('0x21')]({},this['apiAxiosInstance'][a3_0x3ca8('0x1')][a3_0x3ca8('0x19')]),{'Content-Encoding':a3_0x3ca8('0xc'),'Content-Type':'application/octet-stream'})}));if(_0x570f27){_0x4c0438[a3_0x3ca8('0x36')]((0x0,metric_logger_1[a3_0x3ca8('0x2e')])(_0x570f27));if(_0x570f27[a3_0x3ca8('0x1b')]&&_0x570f27[a3_0x3ca8('0x1b')]['runUrl']&&_0x570f27[a3_0x3ca8('0x1b')][a3_0x3ca8('0x33')]==='success'){this['runContext'][a3_0x3ca8('0x32')]=_0x570f27[a3_0x3ca8('0x1b')]['runUrl'];return!![];}if(_0x570f27['data']&&_0x570f27[a3_0x3ca8('0x1b')]['status']){this[a3_0x3ca8('0x26')][a3_0x3ca8('0x1a')]=a3_0x3ca8('0x3c')+JSON[a3_0x3ca8('0x31')](_0x570f27[a3_0x3ca8('0x1b')][a3_0x3ca8('0x37')]);}else if(_0x570f27[a3_0x3ca8('0x1b')]&&typeof _0x570f27[a3_0x3ca8('0x1b')]==='string'){if(_0x570f27['data']!==a3_0x3ca8('0x5')){this[a3_0x3ca8('0x26')][a3_0x3ca8('0x1a')]='Invalid\x20end\x20run\x20response:\x20'+JSON['stringify'](_0x570f27['data']);}}else{this[a3_0x3ca8('0x26')][a3_0x3ca8('0x1a')]=a3_0x3ca8('0x3c')+JSON['stringify'](_0x570f27[a3_0x3ca8('0x1b')]);}if(environment_1[a3_0x3ca8('0x3a')]){output[a3_0x3ca8('0x20')]({'title':'Invalid\x20end\x20run\x20response','bodyLines':[JSON['stringify'](_0x570f27[a3_0x3ca8('0x1b')],null,0x2)]});}}else{output['error']({'title':a3_0x3ca8('0x8'),'bodyLines':[a3_0x3ca8('0x2b'),a3_0x3ca8('0x9'),JSON['stringify'](_0xdb7504,null,0x2),a3_0x3ca8('0x35'),JSON['stringify'](new Error()[a3_0x3ca8('0x29')],null,0x2)]});}return![];}catch(_0x1a5607){_0x4c0438[a3_0x3ca8('0x36')](((_0x9637dd=_0x1a5607===null||_0x1a5607===void 0x0?void 0x0:_0x1a5607[a3_0x3ca8('0x23')])===null||_0x9637dd===void 0x0?void 0x0:_0x9637dd[a3_0x3ca8('0x34')])?(0x0,metric_logger_1['mapRespToPerfEntry'])(_0x1a5607[a3_0x3ca8('0x23')][a3_0x3ca8('0x34')]):metric_logger_1[a3_0x3ca8('0x2a')]);const _0x3ee2c7=(_0x59e317=_0x1a5607[a3_0x3ca8('0x23')])!==null&&_0x59e317!==void 0x0?_0x59e317:_0x1a5607;this[a3_0x3ca8('0x26')][a3_0x3ca8('0x1a')]=this['messages'][a3_0x3ca8('0x3e')](_0x3ee2c7,'api');return![];}});}['nxCloudVersion'](){try{const _0x102276=JSON[a3_0x3ca8('0xe')]((0x0,fs_1['readFileSync'])(a3_0x3ca8('0x3d'))[a3_0x3ca8('0x4')]());return _0x102276['devDependencies'][a3_0x3ca8('0x17')];}catch(_0x3041d0){return a3_0x3ca8('0x3f');}}}exports[a3_0x3ca8('0x24')]=CloudRunApi;