const a5_0x31bf=['default','This\x20can\x20also\x20be\x20a\x20false\x20positive\x20caused\x20by\x20agents\x20that\x20did\x20not\x20shut\x20down\x20correctly.','../../../utilities/create-no-new-messages-timeout','printRunGroupError','next','completedTasks','defineProperty','\x20--parallel\x20--max-parallel=','We\x20have\x20detected\x20other\x20agents\x20running\x20in\x20this\x20workspace.\x20This\x20can\x20cause\x20unexpected\x20behavior.','createNoNewMessagesTimeout','../../../utilities/waiter','taskId','length','apply','wait','Command\x20execution\x20failed\x20(distributed\x20task\x20execution:\x20','../../../utilities/environment','NX_AGENT_NAME','nx.json','catch','target','CIRCLECI','unlinkSync','startAgent','Error:','mkdirSync','push','value','throw','getRunGroup','retryDuring:\x20','./distributed-agent.api','status','__esModule','child_process','then','join','Executing:\x20\x27','If\x20you\x20believe\x20this\x20is\x20the\x20case,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22.','cacheDirectory','random','End\x20all\x20currently\x20running\x20agents,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22,\x20and\x20try\x20again.','/tasks-hashes-','Other\x20Nx\x20Cloud\x20Agents\x20Detected','__awaiter','getTime','completed','retryDuring','env','configuration','includes','inherit','maxParallel:\x20','criticalErrorMessage','floor','--configuration=','executionId','\x20--projects=','params','forEach','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','assign','../../error/print-run-group-error','../../../utilities/metric-logger','We\x20have\x20detected\x20another\x20agent\x20with\x20this\x20ID\x20running\x20in\x20this\x20workspace.\x20This\x20should\x20not\x20happen.','warn','strip-json-comments','Duplicate\x20Agent\x20ID\x20Detected','tasks','.lock','DistributedAgentApi','Fetching\x20tasks...','writeFileSync','../../../utilities/nx-imports','exit','parse','executionId:\x20','projectName','Waiter','true','message','Agent\x20','completedStatusCode','SIGINT','error:\x20','/lockfiles','execSync','note','toString','VERBOSE_LOGGING','error','readFileSync','projects','maxParallel','./node_modules/.cache/nx','Distributed\x20Execution\x20Terminated','Starting\x20an\x20agent\x20for\x20running\x20Nx\x20tasks'];(function(_0xed6972,_0x31bf42){const _0x78893e=function(_0x27103a){while(--_0x27103a){_0xed6972['push'](_0xed6972['shift']());}};_0x78893e(++_0x31bf42);}(a5_0x31bf,0xa2));const a5_0x7889=function(_0xed6972,_0x31bf42){_0xed6972=_0xed6972-0x0;let _0x78893e=a5_0x31bf[_0xed6972];return _0x78893e;};'use strict';var __awaiter=this&&this[a5_0x7889('0x4c')]||function(_0x1509a1,_0x71c4b4,_0x15704b,_0x2a3883){function _0xafd016(_0x413df9){return _0x413df9 instanceof _0x15704b?_0x413df9:new _0x15704b(function(_0x223e49){_0x223e49(_0x413df9);});}return new(_0x15704b||(_0x15704b=Promise))(function(_0x536ab8,_0x2e0053){function _0x47ad01(_0x51decb){try{_0x2b3f27(_0x2a3883[a5_0x7889('0x24')](_0x51decb));}catch(_0x3235b1){_0x2e0053(_0x3235b1);}}function _0x5e14a5(_0x282eeb){try{_0x2b3f27(_0x2a3883[a5_0x7889('0x3c')](_0x282eeb));}catch(_0x4e0ba8){_0x2e0053(_0x4e0ba8);}}function _0x2b3f27(_0x2841a1){_0x2841a1['done']?_0x536ab8(_0x2841a1[a5_0x7889('0x3b')]):_0xafd016(_0x2841a1[a5_0x7889('0x3b')])['then'](_0x47ad01,_0x5e14a5);}_0x2b3f27((_0x2a3883=_0x2a3883[a5_0x7889('0x2d')](_0x1509a1,_0x71c4b4||[]))[a5_0x7889('0x24')]());});};Object[a5_0x7889('0x26')](exports,a5_0x7889('0x41'),{'value':!![]});exports[a5_0x7889('0x37')]=void 0x0;const child_process_1=require(a5_0x7889('0x42'));const stripJsonComments=require(a5_0x7889('0x1'));const distributed_agent_api_1=require(a5_0x7889('0x3f'));const waiter_1=require(a5_0x7889('0x2a'));const environment_1=require(a5_0x7889('0x30'));const print_run_group_error_1=require(a5_0x7889('0x5e'));const create_no_new_messages_timeout_1=require(a5_0x7889('0x22'));const fs_1=require('fs');const metric_logger_1=require(a5_0x7889('0x5f'));const {output}=require(a5_0x7889('0x8'));function executeTasks(_0x1fbae6,_0x1f0c56){return __awaiter(this,void 0x0,void 0x0,function*(){let _0x13f0c2=0x0;let _0x2a575d=null;const _0x1b84f2=(0x0,create_no_new_messages_timeout_1[a5_0x7889('0x29')])();const _0x541e52=new waiter_1[(a5_0x7889('0xd'))]();let _0x385108=[];const _0x26608e=new Date();let _0x419c57=![];while(!![]){if(environment_1[a5_0x7889('0x18')]){output[a5_0x7889('0x16')]({'title':a5_0x7889('0x6')});}_0x2a575d=yield _0x1f0c56['tasks'](_0x2a575d?_0x2a575d[a5_0x7889('0x58')]:null,_0x13f0c2,_0x385108);if(environment_1[a5_0x7889('0x18')]){output[a5_0x7889('0x16')]({'title':'API\x20Response','bodyLines':['completed:\x20'+_0x2a575d['completed'],a5_0x7889('0x3e')+_0x2a575d[a5_0x7889('0x4f')],a5_0x7889('0xb')+_0x2a575d['executionId'],'number\x20of\x20tasks:\x20'+_0x2a575d[a5_0x7889('0x3')]['length'],a5_0x7889('0x13')+_0x2a575d[a5_0x7889('0x55')],a5_0x7889('0x54')+_0x2a575d[a5_0x7889('0x1c')]]});}if(_0x2a575d['criticalErrorMessage']){output['error']({'title':a5_0x7889('0x1e'),'bodyLines':[a5_0x7889('0x38'),_0x2a575d['criticalErrorMessage']]});process[a5_0x7889('0x9')](0x0);}if((_0x2a575d===null||_0x2a575d===void 0x0?void 0x0:_0x2a575d['retryDuring'])&&(_0x2a575d===null||_0x2a575d===void 0x0?void 0x0:_0x2a575d[a5_0x7889('0x4f')])!==0x0&&!_0x419c57&&new Date()[a5_0x7889('0x4d')]()-_0x26608e[a5_0x7889('0x4d')]()>_0x2a575d[a5_0x7889('0x4f')]){yield _0x541e52[a5_0x7889('0x2e')]();continue;}if(_0x2a575d[a5_0x7889('0x4e')])return;_0x1b84f2(_0x2a575d['tasks']['map'](_0x1d802a=>_0x1d802a[a5_0x7889('0x2b')])[a5_0x7889('0x44')](''));if(!_0x2a575d[a5_0x7889('0x58')]){if(environment_1[a5_0x7889('0x18')]){output[a5_0x7889('0x16')]({'title':'Waiting...'});}yield _0x541e52[a5_0x7889('0x2e')]();_0x13f0c2=0x0;_0x385108=[];continue;}_0x541e52['reset']();_0x419c57=!![];const _0x52f3c1=invokeTasksUsingRunMany(_0x1fbae6,_0x2a575d[a5_0x7889('0x58')],_0x2a575d[a5_0x7889('0x3')],_0x2a575d[a5_0x7889('0x1c')]);_0x13f0c2=_0x52f3c1[a5_0x7889('0x11')];_0x385108=_0x52f3c1[a5_0x7889('0x25')];}});}function readCompletedTasks(_0xe4129e,_0x5c79d0){const _0x1d52e7=a5_0x7889('0x2f')+_0x5c79d0+').\x20Tasks\x20hashes\x20haven\x27t\x20been\x20recorded.';let _0xe4cacd;try{const _0x3a6f21=_0xe4129e['cacheDirectory']||'./node_modules/.cache/nx';const _0x65d9d8=_0x3a6f21+a5_0x7889('0x4a')+_0x5c79d0;_0xe4cacd=JSON[a5_0x7889('0xa')]((0x0,fs_1[a5_0x7889('0x1a')])(_0x65d9d8)[a5_0x7889('0x17')]());(0x0,fs_1[a5_0x7889('0x36')])(_0x65d9d8);}catch(_0x531213){throw new Error(_0x1d52e7);}if(_0xe4cacd[a5_0x7889('0x2c')]==0x0){throw new Error(_0x1d52e7);}return _0xe4cacd;}function invokeTasksUsingRunMany(_0x31f78b,_0x275d6b,_0x1c2e21,_0x16260c){let _0x15b2c9=0x0;const _0x5b87b1=[];for(const _0x178e4c of groupByTarget(_0x1c2e21)){const _0x2dbcab=_0x178e4c[a5_0x7889('0x51')]?a5_0x7889('0x57')+_0x178e4c[a5_0x7889('0x51')]:'';const _0x51b27f=_0x16260c>0x1?a5_0x7889('0x27')+_0x16260c:'';const _0x4f8862='npx\x20nx\x20run-many\x20--target='+_0x178e4c[a5_0x7889('0x34')]+'\x20'+_0x2dbcab+a5_0x7889('0x59')+_0x178e4c[a5_0x7889('0x1b')][a5_0x7889('0x44')](',')+'\x20'+_0x178e4c[a5_0x7889('0x5a')]+_0x51b27f;if(environment_1[a5_0x7889('0x18')]){output[a5_0x7889('0x16')]({'title':a5_0x7889('0x45')+_0x4f8862+'\x27'});}try{(0x0,child_process_1[a5_0x7889('0x15')])(_0x4f8862,{'stdio':[a5_0x7889('0x53'),'inherit',a5_0x7889('0x53')],'env':Object['assign'](Object[a5_0x7889('0x5d')]({},process[a5_0x7889('0x50')]),{'NX_CACHE_FAILURES':a5_0x7889('0xe'),'NX_CLOUD_DISTRIBUTED_EXECUTION_ID':_0x275d6b})});}catch(_0x4a6056){if(_0x4a6056[a5_0x7889('0x40')]===environment_1[a5_0x7889('0x5c')]){throw _0x4a6056;}else{_0x15b2c9=0x1;}}finally{_0x5b87b1[a5_0x7889('0x3a')](...readCompletedTasks(_0x31f78b,_0x275d6b));}}return{'completedStatusCode':_0x15b2c9,'completedTasks':_0x5b87b1};}function groupByTarget(_0x9068ff){const _0x45be64=[];_0x9068ff[a5_0x7889('0x5b')](_0x406178=>{const _0x35b613=_0x45be64['find'](_0x5bc5d3=>_0x5bc5d3[a5_0x7889('0x34')]===_0x406178['target']&&_0x5bc5d3[a5_0x7889('0x51')]===_0x406178[a5_0x7889('0x51')]);if(_0x35b613){_0x35b613[a5_0x7889('0x1b')][a5_0x7889('0x3a')](_0x406178[a5_0x7889('0xc')]);}else{_0x45be64['push']({'target':_0x406178[a5_0x7889('0x34')],'projects':[_0x406178[a5_0x7889('0xc')]],'params':_0x406178[a5_0x7889('0x5a')],'configuration':_0x406178[a5_0x7889('0x51')]});}});return _0x45be64;}function getAgentName(){if(process['env'][a5_0x7889('0x31')]!==undefined){return process[a5_0x7889('0x50')]['NX_AGENT_NAME'];}else if(process[a5_0x7889('0x50')][a5_0x7889('0x35')]!==undefined){return process['env']['CIRCLE_STAGE'];}else{return a5_0x7889('0x10')+Math[a5_0x7889('0x56')](Math[a5_0x7889('0x48')]()*0x186a0);}}function createAgentLockfile(_0x4cfdbf,_0x2d81c8){const _0x11b889=_0x4cfdbf[a5_0x7889('0x47')]||a5_0x7889('0x1d');const _0x128cac=_0x11b889+a5_0x7889('0x14');const _0x2afb15=_0x128cac+'/'+_0x2d81c8+a5_0x7889('0x4');if(!(0x0,fs_1['existsSync'])(_0x128cac)){(0x0,fs_1[a5_0x7889('0x39')])(_0x128cac,{'recursive':!![]});}const _0x23c458=(0x0,fs_1['readdirSync'])(_0x128cac);if(_0x23c458[a5_0x7889('0x2c')]){if(_0x23c458[a5_0x7889('0x52')](_0x2d81c8+a5_0x7889('0x4'))){output[a5_0x7889('0x19')]({'title':a5_0x7889('0x2'),'bodyLines':[a5_0x7889('0x60'),'',a5_0x7889('0x49')]});process[a5_0x7889('0x9')](0x1);}output[a5_0x7889('0x0')]({'title':a5_0x7889('0x4b'),'bodyLines':[a5_0x7889('0x28'),'',a5_0x7889('0x21'),a5_0x7889('0x46')]});}(0x0,fs_1[a5_0x7889('0x7')])(_0x2afb15,'');process['on'](a5_0x7889('0x9'),()=>cleanupAgentLockfile(_0x2afb15));process['on'](a5_0x7889('0x12'),()=>cleanupAgentLockfile(_0x2afb15));}function cleanupAgentLockfile(_0x5957d7){if((0x0,fs_1['existsSync'])(_0x5957d7)){(0x0,fs_1[a5_0x7889('0x36')])(_0x5957d7);}}function startAgent(){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x42d642=(0x0,environment_1[a5_0x7889('0x3d')])();if(!_0x42d642){(0x0,print_run_group_error_1[a5_0x7889('0x23')])();return process['exit'](0x1);}output[a5_0x7889('0x16')]({'title':a5_0x7889('0x1f')});const _0x4254b8=JSON['parse'](stripJsonComments((0x0,fs_1[a5_0x7889('0x1a')])(a5_0x7889('0x32'))[a5_0x7889('0x17')]()))['tasksRunnerOptions'][a5_0x7889('0x20')]['options'];const _0x2b5e5f=getAgentName();createAgentLockfile(_0x4254b8,_0x2b5e5f);const _0x1b6e9a=new distributed_agent_api_1[(a5_0x7889('0x5'))](_0x4254b8,_0x42d642,_0x2b5e5f);return executeTasks(_0x4254b8,_0x1b6e9a)[a5_0x7889('0x43')](_0x58a019=>__awaiter(this,void 0x0,void 0x0,function*(){yield(0x0,metric_logger_1['submitRunMetrics'])(_0x4254b8);return _0x58a019;}))[a5_0x7889('0x33')](_0x43671e=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x1b6e9a['completeRunGroupWithError']('Critical\x20Error\x20in\x20Agent:\x20\x22'+_0x43671e[a5_0x7889('0xf')]+'\x22');throw _0x43671e;}));});}exports[a5_0x7889('0x37')]=startAgent;